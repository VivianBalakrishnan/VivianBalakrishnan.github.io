<!-- Search Modal -->
<div id="search-modal" class="fixed top-0 left-0 w-100 h-100 bg-black-50 z-9999 dn items-start justify-center pt4">
    <div class="w-100 w-60-l bg-white pa4 br3 shadow-3 relative" id="search-modal-content" style="max-height: 80vh; overflow-y: auto;">
        <button id="close-search" class="absolute top-1 right-1 f3 black bg-transparent bn pointer z-max" style="line-height: 1;">&times;</button>
        <div id="search"></div>
    </div>
</div>

<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        // Check if PagefindUI is already initialized to prevent errors if this script runs twice (unlikely but good practice)
        if (document.querySelector('.pagefind-ui')) return;

        new PagefindUI({ element: "#search", showSubResults: true });

        const searchTrigger = document.getElementById('search-trigger');
        const searchModal = document.getElementById('search-modal');
        const searchModalContent = document.getElementById('search-modal-content');
        const closeSearch = document.getElementById('close-search');

        function openSearch() {
            searchModal.classList.remove('dn');
            searchModal.classList.add('flex');
            // Focus the input if possible
            setTimeout(() => {
                const input = document.querySelector('.pagefind-ui__search-input');
                if (input) input.focus();
            }, 100);
        }

        function closeSearchModal() {
            searchModal.classList.remove('flex');
            searchModal.classList.add('dn');
        }

        if (searchTrigger) {
            searchTrigger.addEventListener('click', (e) => {
                e.preventDefault();
                openSearch();
            });
        }

        if (closeSearch) {
            closeSearch.addEventListener('click', (e) => {
                e.preventDefault();
                closeSearchModal();
            });
        }

        // Close on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") {
                closeSearchModal();
            }
        });
        
        // Close when clicking outside content (the background overlay)
        if (searchModal) {
            searchModal.addEventListener('click', (e) => {
                // If the click target is the modal container itself (the background)
                if (e.target === searchModal) {
                    closeSearchModal();
                }
            });
        }
    });
</script>